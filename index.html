<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YKS Dijital Hata Defteri & Deneme Takip</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-color: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --header-color: white;
            --main-text-color: #333;
            --container-bg: rgba(255, 255, 255, 0.95);
            --section-title-color: #4a5568;
            --section-border-color: #e2e8f0;
            --upload-area-bg: #f8fafc;
            --upload-area-border: #cbd5e0;
            --upload-area-text: #a0aec0;
            --input-border: #e2e8f0;
            --input-focus-border: #667eea;
            --input-focus-shadow: rgba(102, 126, 234, 0.1);
            --btn-primary-bg: linear-gradient(45deg, #667eea, #764ba2);
            --btn-secondary-bg: #e2e8f0;
            --btn-secondary-text: #4a5568;
            --card-bg: white;
            --card-shadow: rgba(0,0,0,0.1);
            --tag-sinav-bg: #fed7d7;
            --tag-sinav-text: #c53030;
            --tag-brans-bg: #c6f6d5;
            --tag-brans-text: #22543d;
            --tag-konu-bg: #bee3f8;
            --tag-konu-text: #2a69ac;
            --tag-durum-bg: #fbb6ce;
            --tag-durum-text: #97266d;
            --tag-durum-cozuldu-bg: #c6f6d5;
            --tag-durum-cozuldu-text: #22543d;
            --tag-durum-yarim-bg: #faf089;
            --tag-durum-yarim-text: #744210;
            --tag-zorluk-bg: #e9d8fd;
            --tag-zorluk-text: #553c9a;
            --question-comment-bg: #f0f8ff;
            --question-comment-text: #2d3748;
            --question-comment-border: #4299e1;
            --question-source-text: #718096;
            --modal-bg: rgba(0,0,0,0.9);
            --modal-content-bg: white;
            --modal-header-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --modal-header-text: white;
            --modal-body-bg: #f8fafc;
            --modal-details-bg: white;
            --detail-content-bg: #f8fafc;
            --detail-content-border: #667eea;
            --nav-menu-bg: rgba(255, 255, 255, 0.95);
            --nav-menu-item-bg: #e2e8f0;
            --nav-menu-item-text: #4a5568;
            --nav-menu-item-hover-bg: #cbd5e0;
            --test-results-bg: #f8fafc;
            --test-results-net-color: #667eea;
            --test-list-item-bg: #f8fafc;
            --test-net-color: #764ba2;
            --empty-state-text: #718096;
            --sun-moon-color: #FFD700;
        }

        .dark-mode {
            --bg-color: #1a202c;
            --header-color: #e2e8f0;
            --main-text-color: #e2e8f0;
            --container-bg: #2d3748;
            --section-title-color: #e2e8f0;
            --section-border-color: #4a5568;
            --upload-area-bg: #2d3748;
            --upload-area-border: #4a5568;
            --upload-area-text: #a0aec0;
            --input-border: #4a5568;
            --input-focus-border: #9f7aea;
            --input-focus-shadow: rgba(159, 122, 234, 0.2);
            --btn-primary-bg: linear-gradient(45deg, #9f7aea, #d6bcfa);
            --btn-secondary-bg: #4a5568;
            --btn-secondary-text: #e2e8f0;
            --card-bg: #2d3748;
            --card-shadow: rgba(0,0,0,0.4);
            --tag-sinav-bg: #c53030;
            --tag-sinav-text: #fed7d7;
            --tag-brans-bg: #22543d;
            --tag-brans-text: #c6f6d5;
            --tag-konu-bg: #2a69ac;
            --tag-konu-text: #bee3f8;
            --tag-durum-bg: #97266d;
            --tag-durum-text: #fbb6ce;
            --tag-durum-cozuldu-bg: #22543d;
            --tag-durum-cozuldu-text: #c6f6d5;
            --tag-durum-yarim-bg: #744210;
            --tag-durum-yarim-text: #faf089;
            --tag-zorluk-bg: #553c9a;
            --tag-zorluk-text: #e9d8fd;
            --question-comment-bg: #2a4365;
            --question-comment-text: #e2e8f0;
            --question-comment-border: #4299e1;
            --question-source-text: #a0aec0;
            --modal-bg: rgba(0,0,0,0.9);
            --modal-content-bg: #2d3748;
            --modal-header-bg: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            --modal-header-text: #e2e8f0;
            --modal-body-bg: #1a202c;
            --modal-details-bg: #2d3748;
            --detail-content-bg: #4a5568;
            --detail-content-border: #9f7aea;
            --nav-menu-bg: #2d3748;
            --nav-menu-item-bg: #4a5568;
            --nav-menu-item-text: #e2e8f0;
            --nav-menu-item-hover-bg: #6a7483;
            --test-results-bg: #2d3748;
            --test-results-net-color: #9f7aea;
            --test-list-item-bg: #2d3748;
            --test-net-color: #d6bcfa;
            --empty-state-text: #a0aec0;
            --sun-moon-color: #FFD700;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            min-height: 100vh;
            color: var(--main-text-color);
            transition: background 0.5s ease, color 0.5s ease;
        }
        
        input, select, textarea {
            background-color: var(--card-bg);
            color: var(--main-text-color);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: var(--header-color);
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .hamburger {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 2rem;
            color: var(--header-color);
            cursor: pointer;
            z-index: 20;
        }
        
        .dark-mode-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 20;
            color: var(--sun-moon-color);
        }

        .nav-menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 250px;
            height: 100%;
            background: var(--nav-menu-bg);
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            transition: left 0.3s ease-in-out;
            z-index: 15;
        }
        
        .nav-menu.active {
            left: 0;
        }
        
        .nav-menu a {
            display: block;
            padding: 15px;
            margin-bottom: 10px;
            background: var(--nav-menu-item-bg);
            border-radius: 10px;
            text-decoration: none;
            color: var(--nav-menu-item-text);
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .nav-menu a:hover {
            background: var(--nav-menu-item-hover-bg);
            transform: translateX(5px);
        }

        .summary-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .main-page-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            align-items: flex-start;
        }

        .left-column, .right-column {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .upload-section, .filter-section, .test-section, .goals-section, .repeat-section, .gallery, .chart-container {
            background: var(--container-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px var(--card-shadow);
            backdrop-filter: blur(10px);
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--section-title-color);
            border-bottom: 2px solid var(--section-border-color);
            padding-bottom: 10px;
        }

        .upload-area {
            border: 3px dashed var(--upload-area-border);
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: var(--upload-area-bg);
        }

        .upload-area:hover {
            border-color: var(--input-focus-border);
            background: var(--section-border-color);
            transform: translateY(-2px);
        }
        
        .dark-mode .upload-area:hover {
            background: var(--nav-menu-item-bg);
        }

        .upload-area.dragover {
            border-color: var(--input-focus-border);
            background: #e6fffa;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--upload-area-text);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--section-title-color);
        }

        select, input, textarea {
            padding: 12px;
            border: 2px solid var(--input-border);
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            width: 100%;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--input-focus-border);
            box-shadow: 0 0 0 3px var(--input-focus-shadow);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .btn-primary {
            background: var(--btn-primary-bg);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: var(--btn-secondary-bg);
            color: var(--btn-secondary-text);
        }

        .btn-secondary:hover {
            background: var(--nav-menu-item-hover-bg);
        }

        .question-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .question-card {
            background: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px var(--card-shadow);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .question-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px var(--card-shadow);
        }

        .question-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: var(--upload-area-bg);
        }

        .question-info {
            padding: 15px;
            position: relative;
        }

        .question-comment {
            background: var(--question-comment-bg);
            padding: 12px;
            margin: 10px 0;
            border-radius: 10px;
            font-size: 0.9rem;
            color: var(--question-comment-text);
            border-left: 4px solid var(--question-comment-border);
            line-height: 1.4;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .question-comment::before {
            content: "💭 ";
            font-size: 1rem;
        }

        .question-source {
            font-size: 0.8rem;
            color: var(--question-source-text);
            margin-top: 8px;
        }

        .question-source::before {
            content: "📚 ";
        }

        .question-solution-indicator {
            background: var(--tag-durum-cozuldu-bg);
            color: var(--tag-durum-cozuldu-text);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-top: 5px;
            display: inline-block;
        }

        .question-solution-indicator::before {
            content: "✅ ";
        }

        .question-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }

        .tag {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .tag-sinav {
            background: var(--tag-sinav-bg);
            color: var(--tag-sinav-text);
        }

        .tag-brans {
            background: var(--tag-brans-bg);
            color: var(--tag-brans-text);
        }

        .tag-konu {
            background: var(--tag-konu-bg);
            color: var(--tag-konu-text);
        }

        .tag-durum {
            background: var(--tag-durum-bg);
            color: var(--tag-durum-text);
        }

        .tag-durum.cozuldu {
            background: var(--tag-durum-cozuldu-bg);
            color: var(--tag-durum-cozuldu-text);
        }

        .tag-durum.yarim {
            background: var(--tag-durum-yarim-bg);
            color: var(--tag-durum-yarim-text);
        }

        .tag-zorluk {
            background: var(--tag-zorluk-bg);
            color: var(--tag-zorluk-text);
        }

        .tag-zorluk.kolay {
            background: var(--tag-durum-cozuldu-bg);
            color: var(--tag-durum-cozuldu-text);
        }

        .tag-zorluk.orta {
            background: var(--tag-durum-bg);
            color: var(--tag-durum-text);
        }

        .tag-zorluk.zor {
            background: var(--tag-sinav-bg);
            color: var(--tag-sinav-text);
        }
        
        .tag-tekrar {
            background: #d4f7dc;
            color: #2f855a;
        }
        .dark-mode .tag-tekrar {
            background: #2f855a;
            color: #d4f7dc;
        }

        .question-date {
            font-size: 0.9rem;
            color: var(--question-source-text);
            margin-top: 10px;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 0, 0, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 1.2rem;
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            font-weight: bold;
        }

        .delete-btn:hover {
            background: rgba(255, 0, 0, 1);
            transform: scale(1.1);
        }

        .question-card:hover .delete-btn {
            opacity: 1;
        }

        .question-card {
            position: relative;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            background: var(--container-bg);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px var(--card-shadow);
        }

        .stat-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px var(--card-shadow);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--test-results-net-color);
        }

        .stat-label {
            color: var(--question-source-text);
            margin-top: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: var(--modal-bg);
            backdrop-filter: blur(5px);
            overflow-y: auto;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            position: relative;
            margin: 20px auto;
            width: 90vw;
            max-width: 1400px;
            background: var(--modal-content-bg);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        .modal-header {
            background: var(--modal-header-bg);
            color: var(--modal-header-text);
            padding: 20px;
            position: relative;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin: 0;
        }

        .modal-subtitle {
            opacity: 0.9;
            margin-top: 5px;
            font-size: 0.9rem;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            color: var(--modal-header-text);
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .modal-body {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 0;
            min-height: 500px;
        }

        .modal-image-container {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--modal-body-bg);
        }

        .modal-image {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            object-fit: contain;
        }

        .modal-details {
            background: var(--modal-details-bg);
            padding: 30px;
            border-left: 2px solid var(--section-border-color);
            overflow-y: auto;
            max-height: 80vh;
        }

        .detail-section {
            margin-bottom: 25px;
        }

        .detail-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--section-title-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-content {
            background: var(--detail-content-bg);
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--main-text-color);
            border-left: 4px solid var(--detail-content-border);
        }

        .modal-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .status-changer {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-status {
            background: var(--btn-primary-bg);
            color: white;
        }

        .btn-delete {
            background: linear-gradient(45deg, #e53e3e, #c53030);
            color: white;
        }

        .btn-status:hover, .btn-delete:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        @media (max-width: 1024px) {
            .summary-container, .main-page-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 1024px) {
            .modal-body {
                grid-template-columns: 1fr;
            }
            
            .modal-details {
                border-left: none;
                border-top: 2px solid var(--section-border-color);
                max-height: none;
            }
            
            .modal-image-container {
                min-height: 300px;
            }
        }

        @media (max-width: 768px) {
            .modal-content {
                margin: 10px;
                width: calc(100% - 20px);
                max-width: none;
            }
            .modal-header {
                padding: 15px;
            }
            .modal-details {
                padding: 20px;
            }
            .header h1 {
                font-size: 2rem;
            }
            .question-grid {
                grid-template-columns: 1fr;
            }
             .delete-btn {
                opacity: 0.8;
            }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--empty-state-text);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        #fileInput {
            display: none;
        }

        .filter-active {
            background: #667eea !important;
            color: white !important;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .test-input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            align-items: center;
        }
        
        .test-input-grid label {
            grid-column: 1 / 2;
        }

        .test-input-grid .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            grid-column: 2 / 4;
        }

        .test-input-grid input {
            flex-grow: 1;
        }
        
        .test-results {
            margin-top: 20px;
            display: grid;
            gap: 10px;
            background: var(--test-results-bg);
            padding: 15px;
            border-radius: 10px;
        }
        
        .test-results-item {
            display: flex;
            justify-content: space-between;
            font-size: 1rem;
            font-weight: 500;
        }
        
        .test-results-item span:last-child {
            font-weight: 700;
            color: var(--test-results-net-color);
        }

        .test-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--test-list-item-bg);
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .test-list-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transform: translateY(-2px);
        }
        
        .test-info {
            font-size: 1rem;
            color: var(--section-title-color);
        }
        
        .test-info .date {
            font-size: 0.8rem;
            color: var(--question-source-text);
            margin-top: 5px;
        }
        
        .test-net {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--test-net-color);
        }
        
        #tytChartContainer, #aytChartContainer {
            margin-top: 30px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 5px 15px var(--card-shadow);
        }
        
        #solutionImage {
            cursor: zoom-in;
            transition: transform 0.3s ease;
            max-width: 100%;
        }
        
        #solutionImage:hover {
            transform: scale(1.05);
        }

        #fullscreenModal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }
        
        #fullscreenModalContent {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
            border-radius: 10px;
        }
        
        .fullscreen-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .fullscreen-close:hover,
        .fullscreen-close:focus {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="hamburger" onclick="toggleMenu()">☰</div>
    <div class="dark-mode-toggle" id="darkModeToggle">☀️</div>
    <div class="nav-menu" id="navMenu">
        <a href="#" onclick="showPage('questionPage')">📚 Soru Defterim</a>
        <a href="#" onclick="showPage('testPage')">📈 Deneme Takip Sistemi</a>
    </div>

    <div class="container" id="main-container">
        <div class="header">
            <h1>📚 YKS Dijital Hata Defteri & Deneme Takip</h1>
            <p id="sub-header-text">Çözümünü anlayamadığınız soruları organize edin ve tekrar edin</p>
        </div>
        
        <div id="questionPage" class="tab-content active">
            <div class="summary-container">
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalQuestions">0</div>
                        <div class="stat-label">Toplam Soru</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="tytQuestions">0</div>
                        <div class="stat-label">TYT Soruları</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="aytQuestions">0</div>
                        <div class="stat-label">AYT Soruları</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="solvedQuestions">0</div>
                        <div class="stat-label">Çözülmüş</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="todayQuestions">0</div>
                        <div class="stat-label">Bugün Eklenen</div>
                    </div>
                     <div class="stat-card">
                        <div class="stat-number" id="hardQuestions">0</div>
                        <div class="stat-label">Zor Sorular</div>
                    </div>
                </div>
                 <div class="goals-section">
                    <h2 class="section-title">🎯 Haftalık Hedefler & Seriler</h2>
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <label for="weeklyGoalInput">Haftalık Soru Hedefi</label>
                            <input type="number" id="weeklyGoalInput" placeholder="50" style="width: 100px;">
                            <button class="btn btn-primary" onclick="setWeeklyGoal()">Belirle</button>
                        </div>
                        <div>
                            <p id="weeklyGoalStatus">Hedef: Belirlenmedi</p>
                        </div>
                    </div>
                    <div class="stat-card" style="margin-top: 20px;">
                        <div class="stat-number" id="streakCounter">0</div>
                        <div class="stat-label">🔥 Günlük Soru Ekleme Serin</div>
                    </div>
                </div>
            </div>

            <div class="main-page-content">
                <div class="left-column">
                    <div class="upload-section">
                        <h2 class="section-title">➕ Yeni Soru Ekle</h2>
                        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                            <div class="upload-icon">📁</div>
                            <p>Soru görselini buraya sürükleyin veya tıklayın</p>
                            <p style="font-size: 0.9rem; color: #718096; margin-top: 10px;">
                                <span style="font-weight: bold;">İpucu:</span> Mobil cihazlarda bu işlem telefon kamerasını açabilir.
                            </p>
                        </div>
                        <input type="file" id="fileInput" accept="image/*" multiple>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sinavOturumu">Sınav Oturumu</label>
                                <select id="sinavOturumu">
                                    <option value="TYT">TYT</option>
                                    <option value="AYT">AYT</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="brans">Branş</label>
                                <select id="brans">
                                    <option value="Matematik">Matematik</option>
                                    <option value="Fizik">Fizik</option>
                                    <option value="Kimya">Kimya</option>
                                    <option value="Biyoloji">Biyoloji</option>
                                    <option value="Türkçe">Türkçe</option>
                                    <option value="Tarih">Tarih</option>
                                    <option value="Coğrafya">Coğrafya</option>
                                    <option value="Felsefe">Felsefe</option>
                                    <option value="Edebiyat">Edebiyat</option>
                                    <option value="Geometri">Geometri</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="konu">Konu</label>
                            <input type="text" id="konu" placeholder="Örn: Limit, Denge, Mol Kavramı...">
                        </div>
                        <div class="form-group">
                            <label for="durum">Durum</label>
                            <select id="durum">
                                <option value="cozulmedi">❌ Çözülmedi</option>
                                <option value="yarim">⚠️ Yarım Anladım</option>
                                <option value="cozuldu">✅ Çözüldü</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="zorluk">Zorluk Seviyesi</label>
                            <select id="zorluk">
                                <option value="kolay">🟢 Kolay</option>
                                <option value="orta">🟡 Orta</option>
                                <option value="zor">🔴 Zor</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="repeatDate">Tekrar Tarihi (Opsiyonel)</label>
                            <input type="date" id="repeatDate">
                        </div>
                        <div class="form-group">
                            <label for="yorum">Kişisel Notlarım</label>
                            <textarea id="yorum" placeholder="Bu soruyu neden ekledim? Hangi kısmı zorlandım? Çözüm ipucu..." rows="3" style="resize: vertical;"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="kaynak">Kaynak (Opsiyonel)</label>
                            <input type="text" id="kaynak" placeholder="Örn: TYT 2023 Deneme 5...">
                        </div>
                        <button class="btn btn-primary" onclick="saveQuestions()">💾 Soruları Kaydet</button>
                    </div>

                    <div class="filter-section">
                        <h2 class="section-title">🔍 Filtreleme</h2>
                        <div class="form-group">
                            <label for="filterSearchText">Genel Arama</label>
                            <input type="text" id="filterSearchText" placeholder="Konu, yorum veya kaynakta ara..." oninput="applyFilters()">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Sınav Oturumu</label>
                                <select id="filterSinav" onchange="applyFilters()">
                                    <option value="">Tümü</option>
                                    <option value="TYT">TYT</option>
                                    <option value="AYT">AYT</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Branş</label>
                                <select id="filterBrans" onchange="applyFilters()">
                                    <option value="">Tümü</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Durum</label>
                            <select id="filterDurum" onchange="applyFilters()">
                                    <option value="">Tümü</option>
                                <option value="cozulmedi">❌ Çözülmedi</option>
                                <option value="yarim">⚠️ Yarım Anladım</option>
                                <option value="cozuldu">✅ Çözüldü</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Zorluk Seviyesi</label>
                            <select id="filterZorluk" onchange="applyFilters()">
                                <option value="">Tümü</option>
                                <option value="kolay">🟢 Kolay</option>
                                <option value="orta">🟡 Orta</option>
                                <option value="zor">🔴 Zor</option>
                            </select>
                        </div>
                        <button class="btn btn-secondary" onclick="clearFilters()">🗑️ Filtreleri Temizle</button>
                        <button class="btn btn-secondary" onclick="exportData()" style="margin-left: 10px;">📤 Dışa Aktar</button>
                        <button class="btn btn-secondary" onclick="importData()" style="margin-left: 10px;">📥 İçe Aktar</button>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImport(event)">
                    </div>

                    <div class="chart-container">
                        <h3 style="text-align: center; margin-bottom: 20px; color: var(--section-title-color);">Soru Dağılımları</h3>
                        <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px;">
                            <div style="width: 100%; max-width: 400px; height: 400px;">
                                <canvas id="bransChart"></canvas>
                            </div>
                            <div style="width: 100%; max-width: 400px; height: 400px;">
                                <canvas id="zorlukChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="right-column">
                    <div class="repeat-section">
                        <h2 class="section-title">🗓️ Bugün Tekrar Etmen Gereken Sorular</h2>
                        <div class="question-grid" id="repeatQuestionGrid">
                            <div class="empty-state">
                                <div class="empty-state-icon">🎉</div>
                                <h3>Bugün tekrar etmen gereken soru yok!</h3>
                                <p>Tekrar tarihi belirlediğin sorular burada görünecek.</p>
                            </div>
                        </div>
                    </div>
                    <div class="gallery">
                        <h2 class="section-title">📖 Soru Galerim</h2>
                        <div class="question-grid" id="questionGrid">
                            <div class="empty-state">
                                <div class="empty-state-icon">📝</div>
                                <h3>Henüz soru eklenmedi</h3>
                                <p>Yukarıdan soru görseli yükleyerek başlayın!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="testPage" class="tab-content">
            <div class="test-section">
                <h2 class="section-title">📝 Yeni Deneme Sonucu Ekle</h2>
                <div class="form-group">
                    <label for="testType">Sınav Oturumu</label>
                    <select id="testType">
                        <option value="TYT">TYT</option>
                        <option value="AYT">AYT</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="testName">Deneme Adı</label>
                    <input type="text" id="testName" placeholder="Örn: 3D Yayınları Deneme 5">
                </div>
                <hr style="margin: 20px 0; border: none; border-top: 1px dashed var(--section-border-color);">
                <div id="tytTestInputs" class="test-inputs">
                    <h3>TYT Dersleri</h3>
                    <div class="test-input-grid">
                        <label>Matematik</label>
                        <div class="input-group">
                            <input type="number" id="tytMatDogru" placeholder="Doğru">
                            <input type="number" id="tytMatYanlis" placeholder="Yanlış">
                        </div>
                        <label>Türkçe</label>
                        <div class="input-group">
                            <input type="number" id="tytTurkceDogru" placeholder="Doğru">
                            <input type="number" id="tytTurkceYanlis" placeholder="Yanlış">
                        </div>
                        <label>Sosyal</label>
                        <div class="input-group">
                            <input type="number" id="tytSosyalDogru" placeholder="Doğru">
                            <input type="number" id="tytSosyalYanlis" placeholder="Yanlış">
                        </div>
                        <label>Fen</label>
                        <div class="input-group">
                            <input type="number" id="tytFenDogru" placeholder="Doğru">
                            <input type="number" id="tytFenYanlis" placeholder="Yanlış">
                        </div>
                    </div>
                </div>
                <div id="aytTestInputs" class="test-inputs" style="display: none;">
                    <h3>AYT Dersleri</h3>
                    <div class="test-input-grid">
                        <label>Matematik</label>
                        <div class="input-group">
                            <input type="number" id="aytMatDogru" placeholder="Doğru">
                            <input type="number" id="aytMatYanlis" placeholder="Yanlış">
                        </div>
                        <label>Fizik</label>
                        <div class="input-group">
                            <input type="number" id="aytFizikDogru" placeholder="Doğru">
                            <input type="number" id="aytFizikYanlis" placeholder="Yanlış">
                        </div>
                        <label>Kimya</label>
                        <div class="input-group">
                            <input type="number" id="aytKimyaDogru" placeholder="Doğru">
                            <input type="number" id="aytKimyaYanlis" placeholder="Yanlış">
                        </div>
                        <label>Biyoloji</label>
                        <div class="input-group">
                            <input type="number" id="aytBiyolojiDogru" placeholder="Doğru">
                            <input type="number" id="aytBiyolojiYanlis" placeholder="Yanlış">
                        </div>
                        <label>Edebiyat</label>
                        <div class="input-group">
                            <input type="number" id="aytEdebiyatDogru" placeholder="Doğru">
                            <input type="number" id="aytEdebiyatYanlis" placeholder="Yanlış">
                        </div>
                        <label>Coğrafya</label>
                        <div class="input-group">
                            <input type="number" id="aytCografyaDogru" placeholder="Doğru">
                            <input type="number" id="aytCografyaYanlis" placeholder="Yanlış">
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="saveTestResult()">💾 Deneme Sonucunu Kaydet</button>
            </div>
            <div class="test-section" style="margin-top: 30px;">
                <h2 class="section-title">📊 Deneme Sonuçlarım</h2>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="tytAverageNet">0</div>
                        <div class="stat-label">TYT Ortalama Net</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="tytBestNet">0</div>
                        <div class="stat-label">TYT En İyi Net</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="aytAverageNet">0</div>
                        <div class="stat-label">AYT Ortalama Net</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="aytBestNet">0</div>
                        <div class="stat-label">AYT En İyi Net</div>
                    </div>
                </div>
                <div class="test-list-container" id="testListContainer">
                    </div>
            </div>
            <div class="chart-container" style="margin-top: 30px;">
                <h3 style="text-align: center; margin-bottom: 20px; color: var(--section-title-color);">Deneme Netlerinin Değişimi</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 20px; justify-content: center;">
                    <div style="width: 400px; height: 400px;">
                        <canvas id="tytTotalChart"></canvas>
                    </div>
                    <div style="width: 400px; height: 400px;">
                        <canvas id="aytTotalChart"></canvas>
                    </div>
                    <div style="width: 400px; height: 400px;">
                        <canvas id="tytMatChart"></canvas>
                    </div>
                    <div style="width: 400px; height: 400px;">
                        <canvas id="tytTurkceChart"></canvas>
                    </div>
                    <div style="width: 400px; height: 400px;">
                        <canvas id="aytMatChart"></canvas>
                    </div>
                    <div style="width: 400px; height: 400px;">
                        <canvas id="aytFizikChart"></canvas>
                    </div>
                    <div style="width: 400px; height: 400px;">
                        <canvas id="aytKimyaChart"></canvas>
                    </div>
                    <div style="width: 400px; height: 400px;">
                        <canvas id="aytBiyolojiChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="myModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal()">&times;</span>
                <h2 class="modal-title" id="modalTitle">Soru Detayları</h2>
                <p class="modal-subtitle" id="modalDate"></p>
            </div>
            <div class="modal-body">
                <div class="modal-image-container">
                    <img class="modal-image" id="modalImage" src="" alt="Soru Görseli">
                </div>
                <div class="modal-details">
                    <div class="modal-tags" id="modalTags"></div>
                    <div class="detail-section">
                        <div class="detail-title">📚 Kaynak</div>
                        <div class="detail-content" id="modalSource"></div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-title">💭 Kişisel Notlarım</div>
                        <div class="detail-content" id="modalComment"></div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-title">🖼️ Çözüm Görseli</div>
                        <div class="detail-content">
                            <img id="solutionImage" src="" alt="Çözüm Görseli">
                            <p id="noSolutionText" style="font-style: italic; color: #718096; display: none;">Çözüm görseli eklenmemiş.</p>
                            <input type="file" id="solutionInput" accept="image/*" style="margin-top: 10px;">
                            <button class="btn btn-primary" onclick="saveSolutionImage()">Çözümü Kaydet</button>
                        </div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-title">🔄 Durumu Güncelle</div>
                        <div class="status-changer">
                            <select id="modalDurumSelect">
                                <option value="cozulmedi">❌ Çözülmedi</option>
                                <option value="yarim">⚠️ Yarım Anladım</option>
                                <option value="cozuldu">✅ Çözüldü</option>
                            </select>
                            <button class="btn-status" onclick="updateQuestionStatus()">Durumu Güncelle</button>
                        </div>
                    </div>
                    <div class="detail-section">
                        <button class="btn-delete" onclick="deleteQuestion()">❌ Soruyu Sil</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="fullscreenModal" class="modal">
        <span class="fullscreen-close" onclick="closeFullscreenModal()">&times;</span>
        <img id="fullscreenModalContent">
    </div>

    <script>
        const bransList = ['Matematik', 'Fizik', 'Kimya', 'Biyoloji', 'Türkçe', 'Tarih', 'Coğrafya', 'Felsefe', 'Edebiyat', 'Geometri'];
        let questions = [];
        let tests = [];
        let currentQuestionId = null;

        const bransChartConfig = { type: 'pie', data: { labels: [], datasets: [{ data: [], backgroundColor: [] }] }, options: { responsive: true, maintainAspectRatio: false } };
        const zorlukChartConfig = { type: 'pie', data: { labels: [], datasets: [{ data: [], backgroundColor: [] }] }, options: { responsive: true, maintainAspectRatio: false } };
        let bransChart, zorlukChart, tytTotalChart, aytTotalChart;
        let tytMatChart, tytTurkceChart, aytMatChart, aytFizikChart, aytKimyaChart, aytBiyolojiChart;

        function loadData() {
            questions = JSON.parse(localStorage.getItem('yksQuestions')) || [];
            tests = JSON.parse(localStorage.getItem('yksTests')) || [];
            updateUI(); // İlk yüklemede her şeyi güncelle
            checkDailyStreak();
            updateWeeklyGoalStatus();
        }

        function saveToStorage() {
            localStorage.setItem('yksQuestions', JSON.stringify(questions));
            localStorage.setItem('yksTests', JSON.stringify(tests));
        }

        // Genel güncelleme fonksiyonu, sadece ilk yükleme için
        function updateUI() {
            updateQuestionGrid();
            updateStats();
            updateFilterOptions();
            drawCharts();
            updateTestUI();
            updateRepeatQuestions();
        }

        function updateQuestionGrid(filteredQuestions = questions) {
            const grid = document.getElementById('questionGrid');
            grid.innerHTML = '';
            if (filteredQuestions.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📝</div>
                        <h3>${questions.length === 0 ? 'Henüz soru eklenmedi' : 'Filtrelemeye uyan soru bulunamadı'}</h3>
                        <p>${questions.length === 0 ? 'Yukarıdan soru görseli yükleyerek başlayın!' : 'Filtreleri değiştirerek yeniden deneyin.'}</p>
                    </div>
                `;
                return;
            }

            filteredQuestions.sort((a, b) => new Date(b.date) - new Date(a.date));

            filteredQuestions.forEach(q => {
                const card = document.createElement('div');
                card.className = 'question-card';
                card.onclick = () => openModal(q.id);

                let solutionIndicator = '';
                if (q.solution) {
                    solutionIndicator = `<span class="question-solution-indicator">Çözüm Var</span>`;
                }

                let repeatTag = '';
                if (q.repeatDate) {
                    const today = new Date().toISOString().split('T')[0];
                    if (q.repeatDate <= today) {
                        repeatTag = `<span class="tag tag-tekrar">Bugün Tekrar Et!</span>`;
                    }
                }

                card.innerHTML = `
                    <button class="delete-btn" onclick="event.stopPropagation(); deleteQuestionFromCard('${q.id}')">&times;</button>
                    <img src="${q.image}" alt="Soru görseli" class="question-image">
                    <div class="question-info">
                        <div class="question-tags">
                            <span class="tag tag-sinav">${q.sinav}</span>
                            <span class="tag tag-brans">${q.brans}</span>
                            <span class="tag tag-zorluk ${q.zorluk}">${q.zorluk}</span>
                            <span class="tag tag-durum ${q.durum}">${q.durum === 'cozulmedi' ? 'Çözülmedi' : (q.durum === 'yarim' ? 'Yarım' : 'Çözüldü')}</span>
                            ${repeatTag}
                        </div>
                        <p class="question-date">Eklenme Tarihi: ${new Date(q.date).toLocaleDateString()}</p>
                        ${solutionIndicator}
                        <div class="question-comment">${q.yorum || 'Not yok.'}</div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function updateRepeatQuestions() {
            const repeatGrid = document.getElementById('repeatQuestionGrid');
            const today = new Date().toISOString().split('T')[0];
            const repeatQuestions = questions.filter(q => q.repeatDate && q.repeatDate <= today);

            repeatGrid.innerHTML = '';
            if (repeatQuestions.length === 0) {
                repeatGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">🎉</div>
                        <h3>Bugün tekrar etmen gereken soru yok!</h3>
                        <p>Tekrar tarihi belirlediğin sorular burada görünecek.</p>
                    </div>
                `;
                return;
            }

            repeatQuestions.forEach(q => {
                const card = document.createElement('div');
                card.className = 'question-card';
                card.onclick = () => openModal(q.id);

                let solutionIndicator = '';
                if (q.solution) {
                    solutionIndicator = `<span class="question-solution-indicator">Çözüm Var</span>`;
                }

                card.innerHTML = `
                    <button class="delete-btn" onclick="event.stopPropagation(); deleteQuestionFromCard('${q.id}')">&times;</button>
                    <img src="${q.image}" alt="Soru görseli" class="question-image">
                    <div class="question-info">
                        <div class="question-tags">
                            <span class="tag tag-sinav">${q.sinav}</span>
                            <span class="tag tag-brans">${q.brans}</span>
                            <span class="tag tag-zorluk ${q.zorluk}">${q.zorluk}</span>
                            <span class="tag tag-durum ${q.durum}">${q.durum === 'cozulmedi' ? 'Çözülmedi' : (q.durum === 'yarim' ? 'Yarım' : 'Çözüldü')}</span>
                            <span class="tag tag-tekrar">Bugün Tekrar Et!</span>
                        </div>
                        <p class="question-date">Eklenme Tarihi: ${new Date(q.date).toLocaleDateString()}</p>
                        ${solutionIndicator}
                        <div class="question-comment">${q.yorum || 'Not yok.'}</div>
                    </div>
                `;
                repeatGrid.appendChild(card);
            });
        }

        function updateStats() {
            const tytQuestionsCount = questions.filter(q => q.sinav === 'TYT').length;
            const aytQuestionsCount = questions.filter(q => q.sinav === 'AYT').length;
            const todayQuestionsCount = questions.filter(q => {
                const today = new Date().toISOString().split('T')[0];
                return q.date.split('T')[0] === today;
            }).length;
            const solvedQuestionsCount = questions.filter(q => q.durum === 'cozuldu').length;
            const hardQuestionsCount = questions.filter(q => q.zorluk === 'zor').length;

            document.getElementById('totalQuestions').innerText = questions.length;
            document.getElementById('tytQuestions').innerText = tytQuestionsCount;
            document.getElementById('aytQuestions').innerText = aytQuestionsCount;
            document.getElementById('todayQuestions').innerText = todayQuestionsCount;
            document.getElementById('solvedQuestions').innerText = solvedQuestionsCount;
            document.getElementById('hardQuestions').innerText = hardQuestionsCount;
        }

        function updateFilterOptions() {
            const filterBrans = document.getElementById('filterBrans');
            const currentFilter = filterBrans.value;
            filterBrans.innerHTML = '<option value="">Tümü</option>';
            const uniqueBrans = [...new Set(questions.map(q => q.brans))].sort();
            uniqueBrans.forEach(brans => {
                const option = document.createElement('option');
                option.value = brans;
                option.text = brans;
                filterBrans.appendChild(option);
            });
            filterBrans.value = currentFilter;
        }

        async function saveQuestions() {
            const fileInput = document.getElementById('fileInput');
            const images = fileInput.files;

            if (images.length === 0) {
                alert('Lütfen bir görsel seçin.');
                return;
            }

            for (const image of images) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const newQuestion = {
                        id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                        image: e.target.result,
                        sinav: document.getElementById('sinavOturumu').value,
                        brans: document.getElementById('brans').value,
                        konu: document.getElementById('konu').value,
                        durum: document.getElementById('durum').value,
                        zorluk: document.getElementById('zorluk').value,
                        yorum: document.getElementById('yorum').value,
                        kaynak: document.getElementById('kaynak').value,
                        repeatDate: document.getElementById('repeatDate').value,
                        date: new Date().toISOString(),
                        solution: null
                    };

                    questions.push(newQuestion);
                    saveToStorage();
                    
                    // Sadece soru sayfası elemanlarını güncelle
                    updateQuestionGrid();
                    updateStats();
                    updateFilterOptions();
                    drawCharts();
                    updateRepeatQuestions();
                    
                    document.getElementById('konu').value = '';
                    document.getElementById('yorum').value = '';
                    document.getElementById('kaynak').value = '';
                    document.getElementById('repeatDate').value = '';
                    fileInput.value = '';

                    checkDailyStreak(true);
                    updateWeeklyGoalStatus();
                };
                reader.readAsDataURL(image);
            }
        }

        function applyFilters() {
            const filterSinav = document.getElementById('filterSinav').value;
            const filterBrans = document.getElementById('filterBrans').value;
            const filterDurum = document.getElementById('filterDurum').value;
            const filterZorluk = document.getElementById('filterZorluk').value;
            const filterSearchText = document.getElementById('filterSearchText').value.toLowerCase();

            const filtered = questions.filter(q => {
                const matchesSinav = !filterSinav || q.sinav === filterSinav;
                const matchesBrans = !filterBrans || q.brans === filterBrans;
                const matchesDurum = !filterDurum || q.durum === filterDurum;
                const matchesZorluk = !filterZorluk || q.zorluk === filterZorluk;
                const matchesSearch = !filterSearchText ||
                    q.konu.toLowerCase().includes(filterSearchText) ||
                    q.yorum.toLowerCase().includes(filterSearchText) ||
                    q.kaynak.toLowerCase().includes(filterSearchText);
                
                return matchesSinav && matchesBrans && matchesDurum && matchesZorluk && matchesSearch;
            });

            updateQuestionGrid(filtered);
        }

        function clearFilters() {
            document.getElementById('filterSinav').value = '';
            document.getElementById('filterBrans').value = '';
            document.getElementById('filterDurum').value = '';
            document.getElementById('filterZorluk').value = '';
            document.getElementById('filterSearchText').value = '';
            applyFilters();
        }

        function openModal(id) {
            const question = questions.find(q => q.id === id);
            if (!question) return;

            currentQuestionId = id;
            document.getElementById('modalTitle').innerText = `${question.brans} - ${question.konu}`;
            document.getElementById('modalDate').innerText = `Eklenme Tarihi: ${new Date(question.date).toLocaleDateString()}`;
            document.getElementById('modalImage').src = question.image;
            document.getElementById('modalImage').onclick = () => openFullscreenModal(question.image);

            document.getElementById('modalSource').innerText = question.kaynak || 'Belirtilmemiş';
            document.getElementById('modalComment').innerText = question.yorum || 'Not yok.';
            document.getElementById('modalDurumSelect').value = question.durum;

            const solutionImage = document.getElementById('solutionImage');
            const noSolutionText = document.getElementById('noSolutionText');
            if (question.solution) {
                solutionImage.src = question.solution;
                solutionImage.style.display = 'block';
                noSolutionText.style.display = 'none';
                solutionImage.onclick = () => openFullscreenModal(question.solution);
            } else {
                solutionImage.style.display = 'none';
                noSolutionText.style.display = 'block';
            }

            const modalTags = document.getElementById('modalTags');
            modalTags.innerHTML = `
                <span class="tag tag-sinav">${question.sinav}</span>
                <span class="tag tag-brans">${question.brans}</span>
                <span class="tag tag-zorluk ${question.zorluk}">${question.zorluk}</span>
                <span class="tag tag-durum ${question.durum}">${question.durum === 'cozulmedi' ? 'Çözülmedi' : (question.durum === 'yarim' ? 'Yarım' : 'Çözüldü')}</span>
            `;
            if (question.repeatDate) {
                modalTags.innerHTML += `<span class="tag tag-tekrar">Tekrar Tarihi: ${question.repeatDate}</span>`;
            }

            document.getElementById('myModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('myModal').style.display = 'none';
        }

        function openFullscreenModal(imageSrc) {
            const fullscreenModal = document.getElementById('fullscreenModal');
            const fullscreenImage = document.getElementById('fullscreenModalContent');
            fullscreenImage.src = imageSrc;
            fullscreenModal.style.display = 'flex';
        }
        
        function closeFullscreenModal() {
            document.getElementById('fullscreenModal').style.display = 'none';
        }

        async function saveSolutionImage() {
            const solutionInput = document.getElementById('solutionInput');
            const image = solutionInput.files[0];
            if (!image) {
                alert('Lütfen bir çözüm görseli seçin.');
                return;
            }

            const question = questions.find(q => q.id === currentQuestionId);
            if (!question) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                question.solution = e.target.result;
                saveToStorage();
                updateQuestionGrid();
                closeModal();
            };
            reader.readAsDataURL(image);
        }

        function updateQuestionStatus() {
            const newStatus = document.getElementById('modalDurumSelect').value;
            const question = questions.find(q => q.id === currentQuestionId);
            if (!question) return;

            question.durum = newStatus;
            saveToStorage();
            updateQuestionGrid();
            updateStats();
            closeModal();
        }

        function deleteQuestion() {
            if (confirm('Bu soruyu silmek istediğinizden emin misiniz?')) {
                questions = questions.filter(q => q.id !== currentQuestionId);
                saveToStorage();
                updateQuestionGrid();
                updateStats();
                drawCharts();
                closeModal();
            }
        }
        
        function deleteQuestionFromCard(id) {
            if (confirm('Bu soruyu kalıcı olarak silmek istediğinizden emin misiniz?')) {
                questions = questions.filter(q => q.id !== id);
                saveToStorage();
                updateQuestionGrid();
                updateStats();
                drawCharts();
            }
        }

        function toggleMenu() {
            const navMenu = document.getElementById('navMenu');
            navMenu.classList.toggle('active');
        }

        // *** DEĞİŞİKLİK: BU FONKSİYON GÜNCELLENDİ ***
        function showPage(pageId) {
            document.querySelectorAll('.tab-content').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            toggleMenu(); // Menüyü kapat

            // Artık sadece aktif olan sayfanın verileri güncelleniyor
            if (pageId === 'questionPage') {
                updateQuestionGrid();
                updateStats();
                updateFilterOptions();
                drawCharts();
                updateRepeatQuestions();
            } else if (pageId === 'testPage') {
                updateTestUI();
            }
        }

        function saveTestResult() {
            const testType = document.getElementById('testType').value;
            const testName = document.getElementById('testName').value;

            if (!testName) {
                alert('Lütfen deneme adını girin.');
                return;
            }

            let testResult = {
                id: Date.now().toString(),
                date: new Date().toISOString().split('T')[0],
                type: testType,
                name: testName,
                results: {}
            };

            const sections = {
                'TYT': ['tytMat', 'tytTurkce', 'tytSosyal', 'tytFen'],
                'AYT': ['aytMat', 'aytFizik', 'aytKimya', 'aytBiyoloji', 'aytEdebiyat', 'aytCografya']
            };

            let totalNet = 0;
            let isValid = true;

            sections[testType].forEach(section => {
                const dogru = parseFloat(document.getElementById(`${section}Dogru`).value) || 0;
                const yanlis = parseFloat(document.getElementById(`${section}Yanlis`).value) || 0;
                const net = dogru - (yanlis / 4);

                if (isNaN(dogru) || isNaN(yanlis)) {
                    isValid = false;
                }

                testResult.results[section] = { dogru, yanlis, net };
                totalNet += net;
            });

            if (!isValid) {
                alert('Lütfen doğru ve yanlış sayılarını geçerli bir şekilde girin.');
                return;
            }

            testResult.totalNet = totalNet;
            tests.push(testResult);
            saveToStorage();
            updateTestUI();

            document.getElementById('testName').value = '';
            sections[testType].forEach(section => {
                document.getElementById(`${section}Dogru`).value = '';
                document.getElementById(`${section}Yanlis`).value = '';
            });
        }

        function updateTestUI() {
            const testListContainer = document.getElementById('testListContainer');
            testListContainer.innerHTML = '';
            if (tests.length === 0) {
                 testListContainer.innerHTML = `<div class="empty-state">
                    <div class="empty-state-icon">📊</div>
                    <h3>Henüz deneme sonucu eklenmedi</h3>
                    <p>Yukarıdan deneme sonucunu ekleyerek başlayın!</p>
                </div>`;
            } else {
                 tests.sort((a,b) => new Date(b.date) - new Date(a.date));
                 tests.forEach(test => {
                    const listItem = document.createElement('div');
                    listItem.className = 'test-list-item';
                    listItem.innerHTML = `
                        <div class="test-info">
                            <strong>${test.name}</strong> (${test.type})
                            <div class="date">${new Date(test.date).toLocaleDateString()}</div>
                        </div>
                        <div class="test-net">${test.totalNet.toFixed(2)} Net</div>
                    `;
                    testListContainer.appendChild(listItem);
                 });
            }
            drawTestCharts();
            updateTestStats();
        }

        function updateTestStats() {
            const tytTests = tests.filter(t => t.type === 'TYT');
            const aytTests = tests.filter(t => t.type === 'AYT');

            const tytNets = tytTests.map(t => t.totalNet);
            const aytNets = aytTests.map(t => t.totalNet);
            
            const tytAverageNet = tytNets.length > 0 ? (tytNets.reduce((sum, net) => sum + net, 0) / tytNets.length).toFixed(2) : 0;
            const tytBestNet = tytNets.length > 0 ? Math.max(...tytNets).toFixed(2) : 0;
            
            const aytAverageNet = aytNets.length > 0 ? (aytNets.reduce((sum, net) => sum + net, 0) / aytNets.length).toFixed(2) : 0;
            const aytBestNet = aytNets.length > 0 ? Math.max(...aytNets).toFixed(2) : 0;

            document.getElementById('tytAverageNet').innerText = tytAverageNet;
            document.getElementById('tytBestNet').innerText = tytBestNet;
            document.getElementById('aytAverageNet').innerText = aytAverageNet;
            document.getElementById('aytBestNet').innerText = aytBestNet;
        }

        function drawCharts() {
            const bransData = {};
            const zorlukData = {};
            
            questions.forEach(q => {
                bransData[q.brans] = (bransData[q.brans] || 0) + 1;
                zorlukData[q.zorluk] = (zorlukData[q.zorluk] || 0) + 1;
            });
            
            const bransLabels = Object.keys(bransData);
            const bransValues = Object.values(bransData);
            const zorlukLabels = Object.keys(zorlukData);
            const zorlukValues = Object.values(zorlukData);
            
            const bransColors = ['#4299e1', '#48bb78', '#f6ad55', '#e53e3e', '#ecc94b', '#9f7aea', '#ed64a6', '#4fd1c5', '#718096', '#38b2ac'];
            const zorlukColors = ['#48bb78', '#f6ad55', '#e53e3e'];

            if (bransChart) bransChart.destroy();
            if (zorlukChart) zorlukChart.destroy();
            
            bransChart = new Chart(document.getElementById('bransChart').getContext('2d'), {
                type: 'pie',
                data: {
                    labels: bransLabels,
                    datasets: [{
                        data: bransValues,
                        backgroundColor: bransColors.slice(0, bransLabels.length)
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });

            zorlukChart = new Chart(document.getElementById('zorlukChart').getContext('2d'), {
                type: 'pie',
                data: {
                    labels: zorlukLabels,
                    datasets: [{
                        data: zorlukValues,
                        backgroundColor: zorlukColors.slice(0, zorlukLabels.length)
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        function drawTestCharts() {
            const tytTests = tests.filter(t => t.type === 'TYT').sort((a, b) => new Date(a.date) - new Date(b.date));
            const aytTests = tests.filter(t => t.type === 'AYT').sort((a, b) => new Date(a.date) - new Date(b.date));

            const tytLabels = tytTests.map(t => t.name);
            const tytTotalData = tytTests.map(t => t.totalNet.toFixed(2));
            const aytLabels = aytTests.map(t => t.name);
            const aytTotalData = aytTests.map(t => t.totalNet.toFixed(2));

            const tytMatData = tytTests.map(t => t.results.tytMat.net.toFixed(2));
            const tytTurkceData = tytTests.map(t => t.results.tytTurkce.net.toFixed(2));
            const aytMatData = aytTests.map(t => t.results.aytMat ? t.results.aytMat.net.toFixed(2) : 0);
            const aytFizikData = aytTests.map(t => t.results.aytFizik ? t.results.aytFizik.net.toFixed(2) : 0);
            const aytKimyaData = aytTests.map(t => t.results.aytKimya ? t.results.aytKimya.net.toFixed(2) : 0);
            const aytBiyolojiData = aytTests.map(t => t.results.aytBiyoloji ? t.results.aytBiyoloji.net.toFixed(2) : 0);

            const datasets = (data, label, color) => [{
                label: label,
                data: data,
                borderColor: color,
                backgroundColor: 'rgba(0, 0, 0, 0)',
                tension: 0.3
            }];

            const chartOptions = { responsive: true, maintainAspectRatio: false };
            
            if (tytTotalChart) tytTotalChart.destroy();
            tytTotalChart = new Chart(document.getElementById('tytTotalChart').getContext('2d'), {
                type: 'line',
                data: { labels: tytLabels, datasets: datasets(tytTotalData, 'TYT Toplam Net', '#667eea') },
                options: chartOptions
            });

            if (aytTotalChart) aytTotalChart.destroy();
            aytTotalChart = new Chart(document.getElementById('aytTotalChart').getContext('2d'), {
                type: 'line',
                data: { labels: aytLabels, datasets: datasets(aytTotalData, 'AYT Toplam Net', '#764ba2') },
                options: chartOptions
            });

            if (tytMatChart) tytMatChart.destroy();
            tytMatChart = new Chart(document.getElementById('tytMatChart').getContext('2d'), {
                type: 'line',
                data: { labels: tytLabels, datasets: datasets(tytMatData, 'TYT Matematik Net', '#4a5568') },
                options: chartOptions
            });

            if (tytTurkceChart) tytTurkceChart.destroy();
            tytTurkceChart = new Chart(document.getElementById('tytTurkceChart').getContext('2d'), {
                type: 'line',
                data: { labels: tytLabels, datasets: datasets(tytTurkceData, 'TYT Türkçe Net', '#e53e3e') },
                options: chartOptions
            });
            
            if (aytMatChart) aytMatChart.destroy();
            aytMatChart = new Chart(document.getElementById('aytMatChart').getContext('2d'), {
                type: 'line',
                data: { labels: aytLabels, datasets: datasets(aytMatData, 'AYT Matematik Net', '#4a5568') },
                options: chartOptions
            });
            
            if (aytFizikChart) aytFizikChart.destroy();
            aytFizikChart = new Chart(document.getElementById('aytFizikChart').getContext('2d'), {
                type: 'line',
                data: { labels: aytLabels, datasets: datasets(aytFizikData, 'AYT Fizik Net', '#4299e1') },
                options: chartOptions
            });
            
            if (aytKimyaChart) aytKimyaChart.destroy();
            aytKimyaChart = new Chart(document.getElementById('aytKimyaChart').getContext('2d'), {
                type: 'line',
                data: { labels: aytLabels, datasets: datasets(aytKimyaData, 'AYT Kimya Net', '#f6ad55') },
                options: chartOptions
            });
            
            if (aytBiyolojiChart) aytBiyolojiChart.destroy();
            aytBiyolojiChart = new Chart(document.getElementById('aytBiyolojiChart').getContext('2d'), {
                type: 'line',
                data: { labels: aytLabels, datasets: datasets(aytBiyolojiData, 'AYT Biyoloji Net', '#48bb78') },
                options: chartOptions
            });

        }

        document.getElementById('testType').addEventListener('change', (e) => {
            document.getElementById('tytTestInputs').style.display = 'none';
            document.getElementById('aytTestInputs').style.display = 'none';
            document.getElementById(e.target.value === 'TYT' ? 'tytTestInputs' : 'aytTestInputs').style.display = 'block';
        });

        document.getElementById('darkModeToggle').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
            document.getElementById('darkModeToggle').innerText = isDarkMode ? '🌙' : '☀️';
            drawCharts();
            drawTestCharts();
        });

        function loadTheme() {
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeToggle').innerText = '🌙';
            }
        }
        
        function setWeeklyGoal() {
            const goal = parseInt(document.getElementById('weeklyGoalInput').value);
            if (isNaN(goal) || goal <= 0) {
                alert('Lütfen geçerli bir hedef girin.');
                return;
            }
            localStorage.setItem('weeklyQuestionGoal', goal);
            alert(`Haftalık soru hedefiniz ${goal} olarak belirlendi!`);
            updateWeeklyGoalStatus();
        }

        function updateWeeklyGoalStatus() {
            const goal = parseInt(localStorage.getItem('weeklyQuestionGoal') || 0);
            const startOfWeek = new Date();
            startOfWeek.setDate(startOfWeek.getDate() - (startOfWeek.getDay() + 6) % 7);
            startOfWeek.setHours(0, 0, 0, 0);

            const weeklyQuestions = questions.filter(q => new Date(q.date) >= startOfWeek).length;
            const statusText = document.getElementById('weeklyGoalStatus');

            if (goal > 0) {
                const percentage = Math.min((weeklyQuestions / goal) * 100, 100);
                statusText.innerHTML = `Hedef: ${goal} | Bu Hafta: ${weeklyQuestions} <br>
                    <progress value="${weeklyQuestions}" max="${goal}" style="width: 100%; margin-top: 5px;"></progress>`;
            } else {
                statusText.innerText = 'Henüz haftalık hedef belirlenmedi.';
            }
        }

        function checkDailyStreak(questionAdded = false) {
            const today = new Date().toISOString().split('T')[0];
            let streak = parseInt(localStorage.getItem('streak') || 0);
            const lastActiveDay = localStorage.getItem('lastActiveDay');

            if (questionAdded) {
                if (lastActiveDay === today) {
                } else if (lastActiveDay) {
                    const lastDay = new Date(lastActiveDay);
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yesterdayString = yesterday.toISOString().split('T')[0];
                    if (lastActiveDay === yesterdayString) {
                        streak++;
                    } else {
                        streak = 1;
                    }
                    localStorage.setItem('streak', streak);
                    localStorage.setItem('lastActiveDay', today);
                } else {
                    streak = 1;
                    localStorage.setItem('streak', streak);
                    localStorage.setItem('lastActiveDay', today);
                }
            }
            
            document.getElementById('streakCounter').innerText = streak;
        }


        function exportData() {
            if (questions.length === 0 && tests.length === 0) {
                alert('Dışa aktarılacak veri yok!');
                return;
            }
            
            const dataToExport = {
                questions: questions,
                tests: tests
            };

            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `yks-hata-defteri-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('Veriler başarıyla JSON dosyası olarak dışa aktarıldı. Bu dosyayı yedek olarak saklayabilirsiniz.');
        }

        function importData() {
            document.getElementById('importFile').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    let importedQuestions = [];
                    let importedTests = [];

                    if (Array.isArray(importedData)) {
                        importedQuestions = importedData;
                        importedQuestions.forEach(q => {
                            if (!q.id) { q.id = Date.now().toString() + Math.random(); }
                        });
                    } else if (importedData.questions || importedData.tests) {
                        importedQuestions = importedData.questions || [];
                        importedTests = importedData.tests || [];
                    } else {
                        alert('Dosya formatı hatalı! Lütfen geçerli bir JSON dosyası seçin.');
                        return;
                    }
                    
                    if (confirm('Mevcut verileriniz silinecek ve yeni verilerle değiştirilecek. Emin misiniz?')) {
                        questions = importedQuestions;
                        tests = importedTests;
                        saveToStorage();
                        updateUI();
                        alert('Veriler başarıyla içe aktarıldı!');
                    }
                } catch (error) {
                    console.error("İçe aktarma hatası:", error);
                    alert('Dosya formatı hatalı! Lütfen geçerli bir JSON dosyası seçin.');
                }
            };
            reader.readAsText(file);
        }

        window.addEventListener('load', function() {
            loadTheme();
            loadData();
        });
    </script>
</body>
</html>
